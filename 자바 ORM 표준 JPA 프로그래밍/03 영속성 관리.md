## 03 영속성 관리

### EntityManagerFactory와 EntityManager

JPA는 **엔티티와 테이블을 매핑**하는 기능과 **매핑한 엔티티를 사용**하는 기능을 제공한다. `EntityManagerFactory`와 `EntityManger`는 매핑한 엔티티를 사용하기 위해 필요하다.

`EntityManagerFactory`는 EntityManager를 생성한다. EntityMangerFactory는 생성하는데 많은 자원이 필요하므로 애플리케이션에서 한 개만 생성한다. 대신 여러 스레드가 공유할 수 있다.

`EntityManger`는 엔티티를 실질적으로 관리한다. EntityManagerFactory에서 EntityManager를 생성하는 데는 많은 자원이 필요하지 않다. 동시성 문제 발생을 막기 위해 여러 스레드가 공유하지 않도록 요청이 있을 때마다 생성한다. EntityManager가 생성되면 `영속성 컨텍스트(Persistence Context)`도 같이 만들어진다. 영속성 컨텍스트는 엔티티를 영구 저장하는 환경이다.

<img src="./images/03_EMF-and-EM.png" width="50%" height="50%" />