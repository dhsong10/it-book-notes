## 07 고급 매핑

### 상속 관계 매핑

JPA는 객체의 상속 관계를 관계형 데이터베이스의 슈퍼 타입과 서브 타입으로 매핑한다. 상속 관계를 슈퍼 타입과 서브 타입으로 변경하는 전략으로는 세 가지가 있다.

1. **조인 전략**: 각 엔티티마다 테이블을 만든다. 부모 객체에 대응하는 슈퍼 타입 테이블과 자식 객체(들)에 대응하는 서브 타입(들)을 조인해서 비즈니스 로직을 수행한다. 
2. **단일 테이블 전략**: 부모 객체와 자식 객체 모두 단일 테이블에 저장한다. 단일 테이블의 필드는 null 값을 허용한다.
3. **구현 클래스마다 테이블 전략**: 자식 객체(들)에 해당하는 테이블만 만든다. UNION을 사용해서 모든 데이터를 조회한다. 권장하지 않는 방법이다.

### `@MappedSuperclass`

`@MappedSuperclass` 어노테이션은 관계형 데이터베이스의 테이블로 매핑하지 않는 객체에 붙인다. 엔티티가 공통적으로 사용하는 변수들을 묶어서 추상 객체를 만든다. 엔티티는 이 추상 객체를 상속받는다. 추상 객체 자체는 엔티티가 될(관계형 데이터베이스의 테이블로 변환할) 필요가 없다. 

일반적으로 모든 테이블에서 공통적으로 사용하는 요소(생성한 사람, 생성한 일시, 수정한 사람, 수정한 일시)를 추상 객체로 만든다.

### 복합 키 매핑

복합 키는 복수 개의 변수를 기본 키로 사용하는 것이다. 복합 키 매핑을 위한 방법으로 `@IdClass` 어노테이션을 사용하는 방법과 `@EmbeddedId` 어노테이션을 사용하는 방법이 있다. 두 가지 방법 모두 복합 키에 해당하는 신규 클래스를 생성한다. 신규 복합 키 클래스는 `Serializable`을 상속받고, `equals`와 `hashCode`를 구현해야 한다. 이는 영속성 컨텍스트에서 복합 키가 두 엔티티의 동일성을 비교할 때 키로서 사용되기 때문이다. 

1. `@IdClass`
   - 복합 키를 사용할 엔티티에 `@IdClass` 어노테이션을 붙이고, 복합 키 클래스를 속성값으로 설정한다
   - 복합 키가 될 변수들에 `@Id` 어노테이션을 붙인다. 
2. `@EmbeddedId`
   - 복합 키 클래스에 `@Embeddable` 어노테이션을 붙인다.
   - 복합 키를 사용할 엔티티는 복합 키 클래스로 만든 변수를 가진다. 복합 키 변수는 `@EmbeddedId` 어노테이션이 붙는다. 

### 식별과 비식별 관계

식별 관계에서 테이블이 연관 관계를 맺을 때, 테이블의 기본 키가 다른 테이블에서 기본 키이자 외래 키가 된다. 식별 관계에서 기본 키는 비즈니스적 의미를 가진다.

비식별 관계에서 테이블이 연관 관계를 맺을 때, 테이블의 기본 키가 다른 테이블에서 외래 키로만 설정된다. 비식별 관계에서 기본 키는 비즈니스적 의미가 없다. 

비식별 관계를 식별 관계보다 지향한다. 이는 기본 키에 비즈니스 의미가 없기 때문에 시간이 지나도 기본 키가 변할 필요가 없기 때문이다. 또한, 비즈니스 변화에 유연하게 대응할 수 있다.